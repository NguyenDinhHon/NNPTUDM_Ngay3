<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-shop me-2"></i>
                <span class="fw-bold">Product Dashboard</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-house-door me-1"></i> Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-box-seam me-1"></i> Sản phẩm</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="bi bi-info-circle me-1"></i> Giới thiệu</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Header Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm header-card">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <h2 class="mb-1 fw-bold text-primary">
                                    <i class="bi bi-grid-3x3-gap me-2"></i>Danh sách sản phẩm
                                </h2>
                                <p class="text-muted mb-0">Quản lý và xem thông tin các sản phẩm</p>
                            </div>
                            <div class="d-flex align-items-center mt-3 mt-md-0 gap-2 flex-wrap">
                                <span class="badge bg-success p-2">
                                    <i class="bi bi-check-circle me-1"></i>
                                    <span id="productCount">0</span> sản phẩm
                                </span>
                                <button class="btn btn-create" onclick="openCreateModal()" title="Tạo sản phẩm mới">
                                    <i class="bi bi-plus-lg me-1"></i> Tạo mới
                                </button>
                                <div class="btn-group">
                                    <button class="btn btn-export" onclick="exportToCSV()" title="Xuất dữ liệu hiện tại ra file CSV">
                                        <i class="bi bi-download me-1"></i> Export CSV
                                    </button>
                                    <button type="button" class="btn btn-export dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="visually-hidden">Toggle Dropdown</span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end export-dropdown">
                                        <li class="dropdown-header">
                                            <i class="bi bi-file-earmark-arrow-down me-2"></i>Tùy chọn Export
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="exportToCSV('current'); return false;">
                                                <i class="bi bi-filter me-2 text-primary"></i>
                                                <span>Trang hiện tại</span>
                                                <small class="text-muted d-block">Chỉ xuất dữ liệu đang hiển thị</small>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="exportToCSV('filtered'); return false;">
                                                <i class="bi bi-funnel me-2 text-success"></i>
                                                <span>Dữ liệu đã lọc</span>
                                                <small class="text-muted d-block">Xuất tất cả kết quả tìm kiếm</small>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#" onclick="exportToCSV('all'); return false;">
                                                <i class="bi bi-database me-2 text-warning"></i>
                                                <span>Tất cả sản phẩm</span>
                                                <small class="text-muted d-block">Xuất toàn bộ dữ liệu</small>
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li class="dropdown-item-text small text-muted">
                                            <i class="bi bi-info-circle me-1"></i>
                                            File CSV tương thích với Excel
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-outline-primary" onclick="loadProducts()">
                                    <i class="bi bi-arrow-clockwise me-1"></i> Tải lại
                                </button>
                            </div>
                        </div>
                        <!-- Search Box -->
                        <div class="row mt-4">
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="input-group search-box">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="bi bi-search text-muted"></i>
                                    </span>
                                    <input 
                                        type="text" 
                                        class="form-control border-start-0" 
                                        id="searchInput" 
                                        placeholder="Tìm kiếm theo tên sản phẩm..."
                                        autocomplete="off"
                                    >
                                    <button class="btn btn-outline-secondary" type="button" id="clearSearch" title="Xóa tìm kiếm">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center py-5">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Đang tải...</span>
            </div>
            <p class="mt-3 text-muted">Đang tải dữ liệu sản phẩm...</p>
        </div>

        <!-- Error Alert -->
        <div id="errorAlert" class="alert alert-danger d-none" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <span id="errorMessage">Có lỗi xảy ra khi tải dữ liệu.</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Products Table -->
        <div id="productsContainer" class="card border-0 shadow-sm d-none">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-header">
                            <tr>
                                <th scope="col" class="text-center" style="width: 80px;">
                                    <i class="bi bi-hash me-1"></i>ID
                                </th>
                                <th scope="col" style="min-width: 200px;">
                                    <span class="sortable-header" onclick="sortProducts('title')">
                                        <i class="bi bi-tag me-1"></i>Title
                                        <i class="bi bi-arrow-down-up sort-icon ms-1" id="sort-icon-title"></i>
                                    </span>
                                </th>
                                <th scope="col" class="text-end" style="width: 120px;">
                                    <span class="sortable-header" onclick="sortProducts('price')">
                                        <i class="bi bi-currency-dollar me-1"></i>Price
                                        <i class="bi bi-arrow-down-up sort-icon ms-1" id="sort-icon-price"></i>
                                    </span>
                                </th>
                                <th scope="col" style="width: 150px;">
                                    <i class="bi bi-folder me-1"></i>Category
                                </th>
                                <th scope="col" class="text-center" style="width: 120px;">
                                    <i class="bi bi-image me-1"></i>Images
                                </th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be inserted here dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div class="pagination-container p-3 border-top">
                    <div class="row align-items-center">
                        <div class="col-12 col-md-4 mb-3 mb-md-0">
                            <div class="d-flex align-items-center">
                                <label for="itemsPerPage" class="me-2 text-muted small">Hiển thị:</label>
                                <select class="form-select form-select-sm items-per-page" id="itemsPerPage">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                </select>
                                <span class="ms-2 text-muted small">sản phẩm/trang</span>
                            </div>
                        </div>
                        <div class="col-12 col-md-4 text-center mb-3 mb-md-0">
                            <span class="text-muted small" id="paginationInfo">
                                Hiển thị 1-10 của 100 sản phẩm
                            </span>
                        </div>
                        <div class="col-12 col-md-4">
                            <nav aria-label="Product pagination">
                                <ul class="pagination pagination-sm justify-content-md-end justify-content-center mb-0" id="paginationList">
                                    <!-- Pagination will be inserted here dynamically -->
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">Hình ảnh sản phẩm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-0">
                    <img id="modalImage" src="" alt="Product Image" class="img-fluid">
                </div>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
            <div class="modal-content detail-modal">
                <!-- Modal Header -->
                <div class="modal-header detail-modal-header">
                    <div class="d-flex align-items-center">
                        <span class="detail-modal-id me-3" id="detailProductId">ID: 0</span>
                        <h5 class="modal-title mb-0" id="productDetailModalLabel">Chi tiết sản phẩm</h5>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-0">
                    <!-- View Mode -->
                    <div id="viewMode">
                        <div class="row g-0">
                            <!-- Product Image -->
                            <div class="col-md-5 detail-image-container">
                                <img id="detailImage" src="" alt="Product" class="detail-image">
                                <div class="detail-image-overlay">
                                    <button class="btn btn-light btn-sm" onclick="openImageFromDetail()">
                                        <i class="bi bi-arrows-fullscreen me-1"></i> Xem ảnh lớn
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Product Info -->
                            <div class="col-md-7 p-4">
                                <div class="detail-content">
                                    <h3 class="detail-title" id="detailTitle">Product Title</h3>
                                    
                                    <div class="detail-price-category mb-4">
                                        <span class="detail-price" id="detailPrice">$0.00</span>
                                        <span class="detail-category" id="detailCategory">Category</span>
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h6 class="detail-section-title">
                                            <i class="bi bi-text-paragraph me-2"></i>Mô tả sản phẩm
                                        </h6>
                                        <p class="detail-description" id="detailDescription">Description</p>
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h6 class="detail-section-title">
                                            <i class="bi bi-info-circle me-2"></i>Thông tin thêm
                                        </h6>
                                        <div class="detail-meta">
                                            <div class="detail-meta-item">
                                                <span class="detail-meta-label">Ngày tạo:</span>
                                                <span class="detail-meta-value" id="detailCreatedAt">-</span>
                                            </div>
                                            <div class="detail-meta-item">
                                                <span class="detail-meta-label">Cập nhật:</span>
                                                <span class="detail-meta-value" id="detailUpdatedAt">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Edit Mode -->
                    <div id="editMode" class="d-none p-4">
                        <form id="editProductForm">
                            <input type="hidden" id="editProductId">
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="editTitle" class="form-label">
                                        <i class="bi bi-tag me-1"></i>Tên sản phẩm <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="editTitle" required>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="editPrice" class="form-label">
                                        <i class="bi bi-currency-dollar me-1"></i>Giá (USD) <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control" id="editPrice" min="0" step="0.01" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editDescription" class="form-label">
                                    <i class="bi bi-text-paragraph me-1"></i>Mô tả
                                </label>
                                <textarea class="form-control" id="editDescription" rows="4"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editImageUrl" class="form-label">
                                    <i class="bi bi-image me-1"></i>URL Hình ảnh
                                </label>
                                <input type="url" class="form-control" id="editImageUrl" placeholder="https://...">
                                <div class="form-text">Nhập URL hình ảnh sản phẩm</div>
                            </div>
                            
                            <!-- Image Preview -->
                            <div class="mb-3">
                                <label class="form-label">Xem trước hình ảnh</label>
                                <div class="edit-image-preview">
                                    <img id="editImagePreview" src="" alt="Preview">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer detail-modal-footer">
                    <!-- View Mode Footer -->
                    <div id="viewModeFooter" class="d-flex justify-content-between w-100">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-lg me-1"></i>Đóng
                        </button>
                        <button type="button" class="btn btn-edit" onclick="enableEditMode()">
                            <i class="bi bi-pencil-square me-1"></i>Chỉnh sửa
                        </button>
                    </div>
                    
                    <!-- Edit Mode Footer -->
                    <div id="editModeFooter" class="d-none d-flex justify-content-between w-100">
                        <button type="button" class="btn btn-outline-secondary" onclick="cancelEdit()">
                            <i class="bi bi-arrow-left me-1"></i>Hủy
                        </button>
                        <button type="button" class="btn btn-save" onclick="saveProduct()" id="saveBtn">
                            <i class="bi bi-check-lg me-1"></i>Lưu thay đổi
                        </button>
                    </div>
                </div>
                
                <!-- Loading Overlay -->
                <div id="modalLoading" class="modal-loading d-none">
                    <div class="spinner-border text-light" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-light mt-2 mb-0">Đang xử lý...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Product Modal -->
    <div class="modal fade" id="createProductModal" tabindex="-1" aria-labelledby="createProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content create-modal">
                <!-- Modal Header -->
                <div class="modal-header create-modal-header">
                    <div class="d-flex align-items-center">
                        <div class="create-modal-icon me-3">
                            <i class="bi bi-plus-circle"></i>
                        </div>
                        <div>
                            <h5 class="modal-title mb-0" id="createProductModalLabel">Tạo sản phẩm mới</h5>
                            <small class="text-white-50">Điền thông tin để thêm sản phẩm vào hệ thống</small>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body -->
                <div class="modal-body p-4">
                    <form id="createProductForm">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-md-7">
                                <div class="mb-3">
                                    <label for="createTitle" class="form-label">
                                        <i class="bi bi-tag me-1 text-primary"></i>Tên sản phẩm <span class="text-danger">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="createTitle" placeholder="Nhập tên sản phẩm..." required>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="createPrice" class="form-label">
                                            <i class="bi bi-currency-dollar me-1 text-success"></i>Giá (USD) <span class="text-danger">*</span>
                                        </label>
                                        <input type="number" class="form-control" id="createPrice" min="0" step="0.01" placeholder="0.00" required>
                                    </div>
                                    
                                    <div class="col-md-6 mb-3">
                                        <label for="createCategory" class="form-label">
                                            <i class="bi bi-folder me-1 text-warning"></i>Danh mục <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="createCategory" required>
                                            <option value="">-- Chọn danh mục --</option>
                                            <option value="1">Clothes</option>
                                            <option value="2">Electronics</option>
                                            <option value="3">Furniture</option>
                                            <option value="4">Shoes</option>
                                            <option value="5">Miscellaneous</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="createDescription" class="form-label">
                                        <i class="bi bi-text-paragraph me-1 text-info"></i>Mô tả sản phẩm
                                    </label>
                                    <textarea class="form-control" id="createDescription" rows="4" placeholder="Nhập mô tả chi tiết sản phẩm..."></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="createImageUrl" class="form-label">
                                        <i class="bi bi-image me-1 text-secondary"></i>URL Hình ảnh
                                    </label>
                                    <input type="url" class="form-control" id="createImageUrl" placeholder="https://example.com/image.jpg">
                                    <div class="form-text">Để trống sẽ sử dụng ảnh mặc định</div>
                                </div>
                            </div>
                            
                            <!-- Right Column - Image Preview -->
                            <div class="col-md-5">
                                <div class="create-preview-section">
                                    <label class="form-label">
                                        <i class="bi bi-eye me-1"></i>Xem trước
                                    </label>
                                    <div class="create-image-preview-container">
                                        <img id="createImagePreview" src="https://placehold.co/300x300?text=Preview" alt="Preview">
                                        <div class="create-image-placeholder" id="createImagePlaceholder">
                                            <i class="bi bi-image"></i>
                                            <span>Hình ảnh sản phẩm</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Preview Card -->
                                    <div class="create-preview-card mt-3">
                                        <h6 class="create-preview-title" id="previewTitle">Tên sản phẩm</h6>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span class="create-preview-price" id="previewPrice">$0.00</span>
                                            <span class="create-preview-category" id="previewCategory">Danh mục</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Modal Footer -->
                <div class="modal-footer create-modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-lg me-1"></i>Hủy bỏ
                    </button>
                    <button type="button" class="btn btn-create-submit" onclick="createProduct()" id="createBtn">
                        <i class="bi bi-plus-circle me-1"></i>Tạo sản phẩm
                    </button>
                </div>
                
                <!-- Loading Overlay -->
                <div id="createModalLoading" class="modal-loading d-none">
                    <div class="spinner-border text-light" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-light mt-2 mb-0">Đang tạo sản phẩm...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-light">
        <div class="container text-center">
            <span class="text-muted">
                <i class="bi bi-heart-fill text-danger"></i> Product Dashboard &copy; 2026
            </span>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="script.js"></script>
</body>
</html>
